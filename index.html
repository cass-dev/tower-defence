<html>
<head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type"/>
</head>
<body>
<!-- Replace width and height with the desired values -->
<canvas id="amethyst-canvas" width="640" height="640" style="background: #ddddff;"></canvas><br />

<!-- Include the JS generated by `wasm-pack build` -->
<script src="spirv_cross/spirv_cross_wrapper_glsl.js"></script>
<script src='pkg/tower-defence.js'></script>

<script src="js/cpal.js"></script>

<!-- Get the user to execute an action, otherwise audio will not play. -->
<button>Launch tower-defence</button>

<script type=module>
      async function run() {
        const module = window.sc_internal_wrapper().then(async module => {
          window.sc_internal = module;

          await wasm_bindgen('./pkg/tower-defence_bg.wasm');

          let canvas = document.getElementById("amethyst-canvas");

          // The WASM application should not send synchronous requests on the
          // main thread, so we load the files and pass them in.
          let input_bindings = await fetch('config/bindings.ron')
            .then((response) => { return response.text(); });
          console.log(input_bindings);

          wasm_bindgen.TowerDefenceBuilder
            .new()
            .with_canvas(canvas)
            .with_input_bindings(input_bindings)
            .run();
        });
      }

      // run();
      const launchBtn = document.querySelector('button:nth-of-type(1)');
      launchBtn.onclick = function() {
        run();
      };
    </script>

</body>
</html>
